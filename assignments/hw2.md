---
layout: page
title: Assignment 2
permalink: /assignments/hw2
parent: Assignments
---

# Assignment 2: API Implementation **Due Friday Feb 19, 10:00pm EST**{: .label .label-red }

We've got some good news, and some bad news. The good news is that thanks to your design documentation efforts, we now understand Avery's mess of code much better.
The bad news is that we're going to need you to implement even more functionality to really support multiple rooms in Covey.Town's backend server.
In design review, we found the following key issues that weren't addressed by the spec that we gave you in Assignment 1:
* There is no way to list which rooms are available for users to join
* There is no way to tell if a user is joining a room that already existed (perhaps one where they agreed to meet their friends in), or if the room was created on the spot (perhaps they made a typo in the room name)
* Multiple users might want to use the same "friendly name" for their room, like "Coffee Break" - but the design spec only allows for one room with each name.

In light of these concerns, we've sketched out the design for a new, RESTful API for the Covey.Town Room Service. This API consists of two resources:
1. `/rooms` a resource that represents the different rooms available in Covey.Town
1. `/sessions` a resource that represents a player's session in a given room. When a player joins a room, they start a new session.

By separating the resource of `rooms` and `members`, we can de-couple the process of joining a room (becoming a member of that room) and creating the room.
We're also going to add three new important properties to our `room` resource (and, correspondingly, to our `CoveyRoomController` class):
`friendlyName` (a non-unique name that describes the room), `isPubliclyListed` (a boolean value that determines if the room should be listed in the public index of rooms) and
`roomUpdatePassword` (a secret string that is generated by the server and returned to the client that creates the room, allowing the room's `friendlyName` and `isPubliclyListed` fields to be updated in the future).

The API will support the following operations:
* `POST /rooms` - Create a new room. Requires a request body containing the properties `friendlyName: string` and `isPubliclyListed: boolean`. Returns a JSON response body of format `{coveyRoomID: string, coveyRoomPassword: string}`
* `PATCH /rooms/:roomID` - Update the room with a given `coveyRoomID`. Requires a request body containing the properties `coveyRoomID: string, coveyRoomPassword: string`, and the data being changed: one or both of `friendlyName: string`, `isPubliclyListed: boolean`.
* `GET /rooms` - List all rooms that have `isPubliclyListed === true`. Returns a JSON response body of format `{rooms: {friendlyName: string, coveyRoomID: string}[]}`
* `DELETE /rooms/:roomID/:coveyRoomPassword` - Delete a room with a given `coveyRoomID` if it is protected by the room update password `coveyRoomPassword`.
* `POST /sessions` - Create a new session. (This is comparable to the old `roomJoinRequest` from HW1).

Your assignment will be graded following the rubric embedded in this document, which will consist of the marks "Satisfactory," "Meets Minimum Expectations," and "Not Acceptable."
Based on past experiences, we project that this assignment could take you up to 14 hours (depending on your prior preparation).
We encourage you to start early so that you can post questions on Piazza, make the most use of our TAs' tutorials, and
 attend office hours as necessary in order to ensure that you can reach Satisfactory marks across the board.

The objectives for this assignment, are to:
* Expand an existing API following the coding conventions set out in an existing codebase
* Practice asynchronous code, including making HTTP requests
* **TBD something related to part 1**

Part 1 is a coding task, and you will implement it by modifying the handout code that we provide with this assignment.
Part 2 of this assignment should be completed in a text editor or word processor, and submitted as a PDF.

**This is an individual assignment.** 

Please post any questions about this assignment on Piazza.

### Change Log
* 2/5: Initial Release 

## Part 1: 
Avery has provided you with a sketch of the API that you should be implementing, and quite helpfully, has provided type definitions
for the various API calls.
**TODO add starter code**
Extract this archive, run `npm install` in it to fetch all of the dependencies, and open the code in your IDE
to start to get a handle on what Avery did here.
To help you set up a local development environment for this class, we've prepared a tutorial for [setting up a development environment with NodeJS, VSCode and TypeScript]({{ site.baseurl }}{% link tutorials/week1-getting-started.md %}).

### Updating the CoveyRoomsStore
Avery has already modified the `CoveyRoomController` to generate and keep track of the ID and update password for each room, and has stubbed out
functions in `CoveyRoomStore` for creating, updating, listing and deleting rooms. You should begin your implementation with these functions in `CoveyRoomStore.ts`:

```
 /**
   * Returns a list of all of the publicly-visible rooms, representing each room as
   * {friendlyName: string, coveyRoomID: string}
   */
  getRooms(): CoveyRoomList

 /**
   * Creates a new room and returns the room's `CoveyRoomController`.
   *
   * @param friendlyName
   * @param isPubliclyListed
   */
  createRoom(friendlyName: string, isPubliclyListed: boolean): CoveyRoomController

  /**
   * Updates the friendlyName and/or public visibility of a room if there is a room that has the
   * specified ID and password. Only updates fields that are passed (note friendlyName or makePublic
   * might be undefined). Returns true if a room was found matching the ID and password, or false
   * otherwise.
   *
   * @param coveyRoomID
   * @param coveyRoomPassword
   * @param friendlyName
   * @param makePublic
   */
  updateRoom(coveyRoomID: string, coveyRoomPassword: string, friendlyName?: string, makePublic?: boolean): boolean

  /**
   * Deletes the room specified by ID. Only deletes the room if the password specified as a
   * parameter here matches the password stored by the matching CoveyRoomController.
   *
   * Returns true if the room was found, password matched, and the room was deleted. Otherwise
   * returns false.
   *
   * @param coveyRoomID
   * @param coveyRoomPassword
   */
  deleteRoom(coveyRoomID: string, coveyRoomPassword: string): boolean
```

Avery has included a thorough test suite for `CoveyRoomsStore` (`CoveyRoomsStore.test.ts`), which you can run for yourself. Once you believe that you have implemented these functions correctly,
check your progress by running `npm test`.
You should make sure that you pass all of these tests before your proceed.

### Defining the REST API
As in your onboarding assignment, the file `src/router/room.ts` contains all of the HTTP routes for the `/rooms` and `/sessions` APIs.
Avery has added routes to the express server for all of the new API functions listed above *except* for `DELETE /rooms`.
Add a route to `room.ts`, connecting from `DELETE /rooms/:roomID/:roomPassword` to the `roomDeleteHandler`.
Follow the pattern that Avery used in the other request handlers for calling the handler, checking for errors, and sending the response back to the client.

### Implementing the request handlers
As in your onboarding assignment, the file `src/requestHandlers/CoveyRoomRequestHandlers.ts` contains the request handlers that process each client's request and format a response.
To help future-proof the API and make it easier to pass metadata back to the client, each request handler now returns a `ResponseEnvelope`, which consists of a boolean field (`isOK`), an optional status message (`message`), and an optional response payload (`response`) .
When you implement your REST client, you'll find that using a standard approach to pass errors like this is quite useful.

There are four handlers that are entirely unimplemented. Your task is to implement all four of these handlers following the specification, using the existing `roomJoinHandler` as an example.
```
/**
 * List all of the rooms that are set to "publicly visible"
 *
 * The `isOK` field on the envelope must be set to `true` in all cases
 * (this function can not return an error)
 *
 * @see CoveyRoomsStore.getRooms - which will return the list of rooms
 *
 */
export async function roomListHandler(): Promise<ResponseEnvelope<RoomListResponse>>

/**
 * Create a new room and returns its ID and password.
 *
 * Sets the `isOK` field on the envelope to `false` if the `friendlyName` specified is empty
 * (a 0-length string), and also sets the `message` envelope field with a descriptive error.
 *
 * Otherwise, sets the `isOK` field on the envelope to `true` if the request succeeds, and returns
 * the room information inside of the response envelope.
 *
 * @see CoveyRoomsStore.createRoom - which will create and track the new room
 *
 * @param requestData the "friendly name" to assign this room, and its publicly visibility
 *
 */
export async function roomCreateHandler(requestData: RoomCreateRequest): Promise<ResponseEnvelope<RoomCreateResponse>>

/**
 * Deletes a room.
 *
 * Sets the `isOK` field on the envelope to `true` if the room exists, password matches, and room
 * is deleted. Sets the `isOK` field on the envelope to `false` and the `message` field to "Invalid
 * Request" if the room does not exist, or password does not match.
 *
 *
 * Does not return any other data inside of the envelope
 *
 * @see CoveyRoomsStore.deleteRoom - which will delete the room from its store
 *
 * @param requestData the requested room ID to delete and the password specified by the client
 */
export async function roomDeleteHandler(requestData: RoomDeleteRequest): Promise<ResponseEnvelope<Record<string, null>>> 

/**
 * Updates a room's friendlyName and/or public visibility.
 *
 * Sets the `isOK` field on the envelope to `true` if the room exists, password matches, and room
 * is deleted. Sets the `isOK` field on the envelope to `false` and the `message` field to "Invalid
 * Request" if the room does not exist, or password does not match.
 *
 * @see CoveyRoomsStore.updateRoom - which will update the room's data
 *
 * @param requestData the update request. This handler should only update fields of the room only
 *   if the password supplied in the request matches the password on record.
 */
export async function roomUpdateHandler(requestData: RoomUpdateRequest): Promise<ResponseEnvelope<Record<string, null>>> 

``` 

You can test your request handlers in two ways:
1. By continuing the assignment to Part 2: implementing the REST client, and using your client to test your server
1. By submitting your code to GradeScope, the autograder will test your server code.

### Rubric Specification for Part 1
Part 1 will account for 1/3 of your overall grade on this assignment.

To receive a mark of "Satisfactory" for Part 1, your code submission must:
* Pass all included automated tests as reported by `npm test` (the tests in `CoveyRoomStore.test.ts`)
* Pass all of the automated tests run by GradeScope (which are not included in the handout)
* Follow the design specification outlined above
* Conform to our [style guide]({{ site.baseurl }}{% link style.md %}) *and* have no style warnings or errors as reported by `npm run-script lint`
* Have no `@ts-ignore` or `eslint-disable` annotations in the code that you write

To receive a mark of "Meets minimum expectations" for Part 3, your code submission must:
* Pass all included automated tests as reported by `npm test` (the tests in `CoveyRoomStore.test.ts`). Other tests may fail.
* Have no style errors (may have warnings) as reported by `npm run-script lint`
* Have no `@ts-ignore` or `eslint-disable` annotations in the code that you write

**Warning**{: .label .label-yellow }  Submissions that do not meet the above criteria will receive no credit for Part 1.
 **Do not wait to test or style check your code until the last minute.**


## Part 2
Your next task is to implement a client for the REST API that you created in the first part of this assignment.
The client should be implemented in the file `src/client/RoomServiceClient.ts` and use the [axios library](https://www.npmjs.com/package/axios) to make requests to the server.
Avery has stubbed out the client, and even added boilerplate code to create the axios client, and set the `baseURL` property on it.
Implement each one of the API client methods using the `_axios` client. Making a call of `_axios.get('/endpoint');` will result in a `GET` request to `/endpoint` on your server,
`_axios.post('/endpoint', {foo: 'bar'})` will result in a `POST` request to `/endpoint`, passing the request body `{foo: 'bar'}`.

We have created an automated test suite to evaluate the functionality of your API client, and this test suite will run when you submit your assignment to GradeScope.

However, we strongly encourage you to test your API client *locally* (on your own machine), so that you can find and fix errors faster than it would take to zip your code, upload it to GradeScope, and receive results.

You can manually test your API client and API server by:
1. Start the server (`npm run start`)
1. Use the file `src/client/ClientExamples.ts` to manually execute the API. Run this file with `ts-node src/client/ClientExamples.ts`.

### Rubric Specification for Part 2
Part 2 will account for 1/3 of your overall grade on this assignment.

To receive a mark of "Satisfactory" for Part 2, your code submission must:
* Pass all of the automated tests run by GradeScope (which are not included in the handout). All tests must pass.
* Follow the design specification outlined above
* Conform to our [style guide]({{ site.baseurl }}{% link style.md %}) *and* have no style warnings or errors as reported by `npm run-script lint`
* Have no `@ts-ignore` or `eslint-disable` annotations in the code that you write

To receive a mark of "Meets minimum expectations" for Part 3, your code submission must:
* Pass all of the automated tests run by GradeScope (which are not included in the handout). All tests must pass.
* Have no style errors (may have warnings) as reported by `npm run-script lint`
* Have no `@ts-ignore` or `eslint-disable` annotations in the code that you write


**Warning**{: .label .label-yellow }  Submissions that do not meet the above criteria will receive no credit for Part 2.
 **Do not wait to test or style check your code until the last minute.**

## Part 3 TBD


## Submission Instructions
Submit your assignment in GradeScope. The easiest way to get into GradeScope the first time is to first
[sign into Canvas](https://northeastern.instructure.com/courses/60188) and then click the link on our course for "GradeScope". 
You should then also have the option to create an account on GradeScope (if you don't already have one) so that you can log in to GradeScope directly.
Please contact the instructors immediately if you have difficulty accessing the course on GradeScope.

Parts 1 and 2 should be submitted together on GradeScope.
To submit Parts 1 and 2: run the command `npm run-script pack` in your project directory, which will create a zip file that is properly
structured for submission. Submit this zip file to the assignment "Homework 2 (Parts 1 and 2)" on GradeScope.
GradeScope will provide you with feedback on your submission, providing a numeric score for Part 1 and Part 2 of:
* 2 (Satisfactory)
* 1 (Meets minimum expecations)
* 0 (Not passing)

You can also view the complete output from running the tests and linter on GradeScope. If you have any doubts
about the autograder, please contact the course staff immediately. In particular: if you are not able to reproduce
and debug test or linter failures on your local machine, **please** ask the TAs for assistance: otherwise you'll waste
an immense amount of time waiting for the autograder to complete, when you could get the same feedback in seconds running
the tests + linter locally.

**Part 3 submission TBD**
